How Forgot Password Works
Step 1 — Request a reset link
POST /api/v1/auth/forgot-password


{ "email": "user@example.com" }
What happens internally:

Looks up the user by email (only active, non-deleted users)
If email doesn't exist — returns 200 silently (prevents email enumeration attacks; attacker can't tell if an email is registered)
If email exists — generates a 64-byte cryptographically random token (URL-safe Base64)
Stores a SHA-256 hash of the token in the password_reset_tokens table (raw token is never stored)
Sets expiry to 1 hour from now
Builds a reset link: https://femved.com/reset-password?token=<rawToken>
Sends the link via SendGrid email template password_reset
Returns 200 regardless of outcome
Step 2 — Reset the password
POST /api/v1/auth/reset-password


{ "token": "<token from email link>", "newPassword": "NewPass@123" }
What happens internally:

Hashes the submitted token with SHA-256 and looks it up in the DB
Validates it's not used and not expired (1 hour window)
If invalid/expired → returns 400 with: "This reset link is invalid or has expired. Please request a new one."
Hashes the new password with BCrypt (work factor 12) and updates the user
Marks the reset token as IsUsed = true (one-time use only)
Revokes ALL active refresh tokens for that user — forces re-login on all devices
Returns 200
In local dev (no real SendGrid key)
The email send fails silently (we wrapped it in a try-catch), but the token is still saved in the DB. You can grab it directly:


SELECT token_hash, expires_at FROM password_reset_tokens
WHERE user_id = (SELECT id FROM users WHERE email = 'user@example.com')
ORDER BY created_at DESC LIMIT 1;
Since only the hash is stored, you'd need to intercept the raw token from the API logs instead — the reset link is built in memory before being passed to SendGrid, so adding a temporary _logger.LogDebug("Reset link: {Link}", resetLink) at line 79 of the handler would expose it during dev.