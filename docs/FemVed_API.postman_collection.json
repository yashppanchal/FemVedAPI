{
  "info": {
    "_postman_id": "femved-api-v1-complete",
    "name": "FemVed API — Complete Test Suite",
    "description": "End-to-end test suite covering all 66 endpoints. Run folders in order: Step 1 → Step 12.\n\n## One-time DB Setup (run in pgAdmin before testing)\n\n### Create Admin user (password: Admin@12345)\n```sql\nINSERT INTO users (id, email, password_hash, role_id, first_name, last_name, country_iso_code, country_dial_code, is_email_verified, is_active, is_deleted, whats_app_opt_in, created_at, updated_at)\nVALUES (gen_random_uuid(), 'admin@femved.com', '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TiGnikmklte5aCEtlnPAUGCqV3qK', 1, 'Admin', 'FemVed', 'GB', '+44', true, true, false, false, NOW(), NOW());\n```\n\n### After running Step 3 (Register Expert), promote to Expert role\n```sql\nUPDATE users SET role_id = 2 WHERE email = 'expert@femved.com';\nINSERT INTO experts (id, user_id, display_name, title, bio, expert_grid_description, expert_detailed_description, specialisations, is_active, is_deleted, created_at, updated_at)\nVALUES (gen_random_uuid(), (SELECT id FROM users WHERE email = 'expert@femved.com'), 'Wellness Expert', 'Wellness Expert Title', 'Full bio here', 'Short grid bio here', NULL, ARRAY['Hormonal Health'], true, false, NOW(), NOW());\n```",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl",          "value": "http://localhost:5064/api/v1", "type": "string" },
    { "key": "userToken",        "value": "", "type": "string" },
    { "key": "userRefreshToken", "value": "", "type": "string" },
    { "key": "userId",           "value": "", "type": "string" },
    { "key": "adminToken",       "value": "", "type": "string" },
    { "key": "expertToken",      "value": "", "type": "string" },
    { "key": "expertId",         "value": "", "type": "string" },
    { "key": "domainId",         "value": "", "type": "string" },
    { "key": "categoryId",       "value": "", "type": "string" },
    { "key": "categorySlug",     "value": "hormonal-health-support", "type": "string" },
    { "key": "programId",        "value": "", "type": "string" },
    { "key": "programSlug",      "value": "stress-hormone-triangle", "type": "string" },
    { "key": "durationId",       "value": "", "type": "string" },
    { "key": "priceId",          "value": "", "type": "string" },
    { "key": "orderId",          "value": "", "type": "string" },
    { "key": "accessId",         "value": "", "type": "string" },
    { "key": "couponId",         "value": "", "type": "string" },
    { "key": "couponCode",       "value": "TEST10", "type": "string" },
    { "key": "gdprRequestId",    "value": "", "type": "string" },
    { "key": "resetToken",       "value": "", "type": "string" }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [{ "key": "token", "value": "{{userToken}}", "type": "string" }]
  },
  "item": [

    {
      "name": "Step 1 — Auth (User)",
      "item": [
        {
          "name": "1.1 Register (User)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('userToken', j.accessToken);",
            "pm.collectionVariables.set('userRefreshToken', j.refreshToken);",
            "pm.collectionVariables.set('userId', j.user.id);",
            "console.log('User registered:', j.user.email);"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\",\n  \"email\": \"testuser@example.com\",\n  \"password\": \"Test@12345\",\n  \"countryCode\": \"+44\",\n  \"mobileNumber\": \"7700900001\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth", "register"] }
          }
        },
        {
          "name": "1.2 Login (User)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('userToken', j.accessToken);",
            "pm.collectionVariables.set('userRefreshToken', j.refreshToken);",
            "pm.collectionVariables.set('userId', j.user.id);"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"email\": \"testuser@example.com\",\n  \"password\": \"Test@12345\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        },
        {
          "name": "1.3 Refresh Token",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('userToken', j.accessToken);",
            "pm.collectionVariables.set('userRefreshToken', j.refreshToken);"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"refreshToken\": \"{{userRefreshToken}}\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/refresh", "host": ["{{baseUrl}}"], "path": ["auth", "refresh"] }
          }
        },
        {
          "name": "1.4 Forgot Password",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Check API logs for reset link (email not sent in dev)');"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"email\": \"testuser@example.com\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/forgot-password", "host": ["{{baseUrl}}"], "path": ["auth", "forgot-password"] }
          }
        },
        {
          "name": "1.5 Reset Password (paste token from DB/logs into resetToken variable)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"token\": \"{{resetToken}}\",\n  \"newPassword\": \"Test@NewPass1\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/reset-password", "host": ["{{baseUrl}}"], "path": ["auth", "reset-password"] }
          }
        },
        {
          "name": "1.6 Verify Email (paste JWT token from DB/logs into resetToken variable)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/auth/verify-email?token={{resetToken}}", "host": ["{{baseUrl}}"], "path": ["auth", "verify-email"], "query": [{ "key": "token", "value": "{{resetToken}}" }] }
          }
        },
        {
          "name": "1.7 Logout",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has confirmation payload', () => {",
            "  pm.expect(j).to.have.property('userId');",
            "  pm.expect(j).to.have.property('isLoggedOut', true);",
            "});"
          ]}}],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"refreshToken\": \"{{userRefreshToken}}\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/logout", "host": ["{{baseUrl}}"], "path": ["auth", "logout"] }
          }
        }
      ]
    },

    {
      "name": "Step 2 — Admin Login & Catalog Setup",
      "description": "Requires admin user created in DB first. See collection description for SQL.",
      "item": [
        {
          "name": "2.1 Login (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('adminToken', j.accessToken);",
            "console.log('Admin logged in:', j.user.email);"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"email\": \"admin@femved.com\",\n  \"password\": \"Admin@12345\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        },
        {
          "name": "2.2 Create Domain",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const id = pm.response.json();",
            "pm.collectionVariables.set('domainId', id);",
            "console.log('Domain created:', id);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"name\": \"Guided 1:1 Care\",\n  \"slug\": \"guided-care\",\n  \"sortOrder\": 1\n}" },
            "url": { "raw": "{{baseUrl}}/guided/domains", "host": ["{{baseUrl}}"], "path": ["guided", "domains"] }
          }
        },
        {
          "name": "2.3 Update Domain",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"name\": \"Guided 1:1 Care\",\n  \"sortOrder\": 1\n}" },
            "url": { "raw": "{{baseUrl}}/guided/domains/{{domainId}}", "host": ["{{baseUrl}}"], "path": ["guided", "domains", "{{domainId}}"] }
          }
        },
        {
          "name": "2.4 Create Category",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const id = pm.response.json();",
            "pm.collectionVariables.set('categoryId', id);",
            "console.log('Category created:', id);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"domainId\": \"{{domainId}}\",\n  \"name\": \"hormonal-health-support\",\n  \"slug\": \"hormonal-health-support\",\n  \"categoryType\": \"Hormonal Health Support\",\n  \"heroTitle\": \"Get Guided Hormonal Care\",\n  \"heroSubtext\": \"Expert-led programs for hormonal balance\",\n  \"ctaLabel\": \"Book Your Program\",\n  \"ctaLink\": \"/guided/hormonal-health-support\",\n  \"pageHeader\": \"Our Hormonal Health Programs\",\n  \"imageUrl\": \"https://example.com/hormonal.jpg\",\n  \"sortOrder\": 1,\n  \"whatsIncluded\": [\"1:1 expert sessions\", \"Personalised plan\", \"WhatsApp support\"],\n  \"keyAreas\": [\"PCOS\", \"Thyroid\", \"Perimenopause\", \"Stress & Hormones\"]\n}" },
            "url": { "raw": "{{baseUrl}}/guided/categories", "host": ["{{baseUrl}}"], "path": ["guided", "categories"] }
          }
        },
        {
          "name": "2.5 Update Category",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"heroTitle\": \"Get Expert Hormonal Care\",\n  \"heroSubtext\": \"Updated subtext\"\n}" },
            "url": { "raw": "{{baseUrl}}/guided/categories/{{categoryId}}", "host": ["{{baseUrl}}"], "path": ["guided", "categories", "{{categoryId}}"] }
          }
        }
      ]
    },

    {
      "name": "Step 3 — Expert: Register & Login",
      "description": "Register the expert user first, then run the pgAdmin SQL (in collection description) to promote to Expert role and create expert profile.",
      "item": [
        {
          "name": "3.1 Register (Expert User)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "console.log('Expert user registered. Now run pgAdmin SQL to set role_id=2 and insert into experts table, then run 3.2.');"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"firstName\": \"Jane\",\n  \"lastName\": \"Expert\",\n  \"email\": \"expert@femved.com\",\n  \"password\": \"Expert@12345\",\n  \"countryCode\": \"+44\",\n  \"mobileNumber\": \"7700900002\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth", "register"] }
          }
        },
        {
          "name": "3.2 Login (Expert)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('expertToken', j.accessToken);",
            "console.log('Expert logged in:', j.user.email);"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"email\": \"expert@femved.com\",\n  \"password\": \"Expert@12345\"\n}" },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        }
      ]
    },

    {
      "name": "Step 4 — Expert: Program & Duration/Price Management",
      "item": [
        {
          "name": "4.1 Create Program (Draft)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const id = pm.response.json();",
            "pm.collectionVariables.set('programId', id);",
            "console.log('Program created:', id);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"categoryId\": \"{{categoryId}}\",\n  \"name\": \"Break the Stress Hormone Health Triangle\",\n  \"slug\": \"stress-hormone-triangle\",\n  \"gridDescription\": \"A 6-week guided program to rebalance your hormones.\",\n  \"gridImageUrl\": \"https://example.com/program.jpg\",\n  \"overview\": \"This program combines functional nutrition and lifestyle coaching.\",\n  \"sortOrder\": 1,\n  \"durations\": [\n    {\n      \"label\": \"4 weeks\",\n      \"weeks\": 4,\n      \"sortOrder\": 0,\n      \"prices\": [\n        { \"locationCode\": \"GB\", \"amount\": 280, \"currencyCode\": \"GBP\", \"currencySymbol\": \"£\" },\n        { \"locationCode\": \"IN\", \"amount\": 28000, \"currencyCode\": \"INR\", \"currencySymbol\": \"₹\" }\n      ]\n    },\n    {\n      \"label\": \"6 weeks\",\n      \"weeks\": 6,\n      \"sortOrder\": 1,\n      \"prices\": [\n        { \"locationCode\": \"GB\", \"amount\": 320, \"currencyCode\": \"GBP\", \"currencySymbol\": \"£\" },\n        { \"locationCode\": \"IN\", \"amount\": 33000, \"currencyCode\": \"INR\", \"currencySymbol\": \"₹\" }\n      ]\n    }\n  ],\n  \"whatYouGet\": [\"Weekly 1:1 video calls\", \"Personalised nutrition plan\", \"WhatsApp support\"],\n  \"whoIsThisFor\": [\"Women with PCOS\", \"Anyone with irregular cycles\", \"Stress-related hormone issues\"],\n  \"tags\": [\"hormones\", \"pcos\", \"stress\"],\n  \"detailSections\": [\n    { \"heading\": \"Reset Stress Patterns\", \"description\": \"Learn to identify and reset your stress-hormone response cycle.\", \"sortOrder\": 0 }\n  ]\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs", "host": ["{{baseUrl}}"], "path": ["guided", "programs"] }
          }
        },
        {
          "name": "4.2 Update Program",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"gridDescription\": \"Updated: A guided program to rebalance your hormones naturally.\"\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}"] }
          }
        },

        {
          "name": "4.3 GET All Durations (management — all prices, all locations)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Returns array of durations', () => pm.expect(j).to.be.an('array'));",
            "if (j.length > 0) {",
            "  pm.collectionVariables.set('durationId', j[0].durationId);",
            "  console.log('durationId captured:', j[0].durationId, '| label:', j[0].label);",
            "  if (j[0].prices && j[0].prices.length > 0) {",
            "    pm.collectionVariables.set('priceId', j[0].prices[0].priceId);",
            "    console.log('priceId captured:', j[0].prices[0].priceId, '| location:', j[0].prices[0].locationCode);",
            "  }",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations",
              "host": ["{{baseUrl}}"],
              "path": ["guided", "programs", "{{programId}}", "durations"],
              "query": [
                { "key": "isActive", "value": "true", "disabled": true, "description": "Filter durations: true=active only, false=inactive only, omit=all" }
              ]
            }
          }
        },
        {
          "name": "4.4 GET Single Duration",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has duration fields', () => {",
            "  pm.expect(j).to.have.property('durationId');",
            "  pm.expect(j).to.have.property('label');",
            "  pm.expect(j).to.have.property('weeks');",
            "  pm.expect(j).to.have.property('prices');",
            "});",
            "console.log('Duration:', j.label, '| Prices:', j.prices.length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}"] }
          }
        },
        {
          "name": "4.5 Add New Duration (10 weeks) — captures new durationId",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const id = pm.response.json();",
            "pm.collectionVariables.set('durationId', id);",
            "console.log('New duration created:', id, '— durationId updated for next update/deactivate tests');"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"label\": \"10 weeks\",\n  \"weeks\": 10,\n  \"sortOrder\": 2,\n  \"prices\": [\n    { \"locationCode\": \"GB\", \"amount\": 480, \"currencyCode\": \"GBP\", \"currencySymbol\": \"£\" },\n    { \"locationCode\": \"IN\", \"amount\": 45000, \"currencyCode\": \"INR\", \"currencySymbol\": \"₹\" },\n    { \"locationCode\": \"US\", \"amount\": 550, \"currencyCode\": \"USD\", \"currencySymbol\": \"$\" }\n  ]\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations"] }
          }
        },
        {
          "name": "4.6 Update Duration (label + weeks)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"label\": \"10 weeks (intensive)\",\n  \"sortOrder\": 2\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}"] }
          }
        },
        {
          "name": "4.7 Deactivate Duration (soft — is_active = false)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has delete payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isDeleted', true);",
            "});",
            "console.log('Duration deactivated:', pm.collectionVariables.get('durationId'));"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}"] }
          }
        },

        {
          "name": "4.8 GET All Prices for Duration (all locations)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Returns array of prices', () => pm.expect(j).to.be.an('array'));",
            "if (j.length > 0) {",
            "  pm.collectionVariables.set('priceId', j[0].priceId);",
            "  console.log('priceId captured:', j[0].priceId, '| location:', j[0].locationCode, '| amount:', j[0].amount);",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}/prices",
              "host": ["{{baseUrl}}"],
              "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}", "prices"],
              "query": [
                { "key": "isActive", "value": "true", "disabled": true, "description": "Filter prices: true=active only, false=inactive only, omit=all" },
                { "key": "locationCode", "value": "GB", "disabled": true, "description": "Filter by ISO country code, e.g. GB, IN, US. Omit to return all locations." }
              ]
            }
          }
        },
        {
          "name": "4.9 GET Single Price",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has price fields', () => {",
            "  pm.expect(j).to.have.property('priceId');",
            "  pm.expect(j).to.have.property('locationCode');",
            "  pm.expect(j).to.have.property('amount');",
            "  pm.expect(j).to.have.property('currencyCode');",
            "  pm.expect(j).to.have.property('isActive');",
            "});",
            "console.log('Price:', j.locationCode, j.currencySymbol + j.amount);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}/prices/{{priceId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}", "prices", "{{priceId}}"] }
          }
        },
        {
          "name": "4.10 Add Price to Duration (AU) — captures new priceId",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const id = pm.response.json();",
            "pm.collectionVariables.set('priceId', id);",
            "console.log('New price created (AU):', id);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"locationCode\": \"AU\",\n  \"amount\": 620,\n  \"currencyCode\": \"AUD\",\n  \"currencySymbol\": \"A$\"\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}/prices", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}", "prices"] }
          }
        },
        {
          "name": "4.11 Update Price (AU amount)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"amount\": 650\n}" },
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}/prices/{{priceId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}", "prices", "{{priceId}}"] }
          }
        },
        {
          "name": "4.12 Deactivate Price (soft — is_active = false)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has delete payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isDeleted', true);",
            "});",
            "console.log('Price deactivated:', pm.collectionVariables.get('priceId'));"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/durations/{{durationId}}/prices/{{priceId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "durations", "{{durationId}}", "prices", "{{priceId}}"] }
          }
        },

        {
          "name": "4.13 Submit Program for Review",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has lifecycle payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('status');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});",
            "console.log('Program in PENDING_REVIEW. Run 4.14 as Admin to publish.');"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "POST",
            "header": [],
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/submit", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "submit"] }
          }
        },
        {
          "name": "4.14 Publish Program (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has publish payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('status', 'PUBLISHED');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});",
            "console.log('Program is now PUBLISHED and visible in the catalog.');"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [],
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/publish", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "publish"] }
          }
        },
        {
          "name": "4.15 Archive Program (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has archive payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('status', 'ARCHIVED');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [],
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}/archive", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}", "archive"] }
          }
        }
      ]
    },

    {
      "name": "Step 5 — Public Catalog",
      "item": [
        {
          "name": "5.1 GET Guided Tree (auto-captures durationId if program published)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "try {",
            "  const dur = j.domains[0].categories[0].programsInCategory[0].programDurations[0];",
            "  if (dur) { pm.collectionVariables.set('durationId', dur.durationId); console.log('durationId captured from tree:', dur.durationId); }",
            "} catch(e) { console.log('No programs in tree yet — publish one first (Step 4.14). Using durationId from Step 4.'); }"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/guided/tree", "host": ["{{baseUrl}}"], "path": ["guided", "tree"] }
          }
        },
        {
          "name": "5.2 GET Category by Slug",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/guided/categories/{{categorySlug}}", "host": ["{{baseUrl}}"], "path": ["guided", "categories", "{{categorySlug}}"] }
          }
        },
        {
          "name": "5.3 GET Program by Slug",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));"
          ]}}],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programSlug}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programSlug}}"] }
          }
        }
      ]
    },

    {
      "name": "Step 6 — User: Place Order",
      "description": "Requires a published program. durationId is captured from Step 5.1 (or Step 4.3 as fallback). countryCode and gateway are optional — defaults to GB + PayPal.",
      "item": [
        {
          "name": "6.1 Create Coupon for Testing (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const j = pm.response.json();",
            "if (j.couponId) pm.collectionVariables.set('couponId', j.couponId);",
            "else if (j.id) pm.collectionVariables.set('couponId', j.id);",
            "console.log('Coupon TEST10 created');"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"code\": \"TEST10\",\n  \"discountType\": \"Percentage\",\n  \"discountValue\": 10,\n  \"maxUses\": 100\n}" },
            "url": { "raw": "{{baseUrl}}/admin/coupons", "host": ["{{baseUrl}}"], "path": ["admin", "coupons"] }
          }
        },
        {
          "name": "6.2 Initiate Order (defaults — GB + PayPal)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('orderId', j.orderId);",
            "console.log('Order created:', j.orderId, '| Gateway:', j.gateway, '| Amount:', j.amount, j.currency);"
          ]}}],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"durationId\": \"{{durationId}}\",\n  \"idempotencyKey\": \"{{$guid}}\"\n}" },
            "url": { "raw": "{{baseUrl}}/orders/initiate", "host": ["{{baseUrl}}"], "path": ["orders", "initiate"] }
          }
        },
        {
          "name": "6.3 Initiate Order (explicit countryCode + gateway)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('orderId', j.orderId);",
            "console.log('Order (explicit IN+CashFree):', j.orderId, '| Gateway:', j.gateway, '| Amount:', j.amount, j.currency);"
          ]}}],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"durationId\": \"{{durationId}}\",\n  \"idempotencyKey\": \"{{$guid}}\",\n  \"countryCode\": \"IN\",\n  \"gateway\": \"CashFree\"\n}" },
            "url": { "raw": "{{baseUrl}}/orders/initiate", "host": ["{{baseUrl}}"], "path": ["orders", "initiate"] }
          }
        },
        {
          "name": "6.4 Initiate Order (with coupon)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 201', () => pm.response.to.have.status(201));",
            "const j = pm.response.json();",
            "pm.collectionVariables.set('orderId', j.orderId);",
            "console.log('Order with coupon:', j.orderId, '| Amount:', j.amount);"
          ]}}],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"durationId\": \"{{durationId}}\",\n  \"couponCode\": \"{{couponCode}}\",\n  \"idempotencyKey\": \"{{$guid}}\"\n}" },
            "url": { "raw": "{{baseUrl}}/orders/initiate", "host": ["{{baseUrl}}"], "path": ["orders", "initiate"] }
          }
        },
        {
          "name": "6.5 GET Order by ID",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 403, 404]));"
          ]}}],
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/orders/{{orderId}}", "host": ["{{baseUrl}}"], "path": ["orders", "{{orderId}}"] }
          }
        },
        {
          "name": "6.6 GET My Orders",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('My orders:', pm.response.json().length);"
          ]}}],
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/orders/my", "host": ["{{baseUrl}}"], "path": ["orders", "my"] }
          }
        }
      ]
    },

    {
      "name": "Step 7 — User: Profile & Program Access",
      "item": [
        {
          "name": "7.1 GET My Profile",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Profile email:', pm.response.json().email);"
          ]}}],
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/users/me", "host": ["{{baseUrl}}"], "path": ["users", "me"] }
          }
        },
        {
          "name": "7.2 UPDATE My Profile",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));"
          ]}}],
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"firstName\": \"Test Updated\",\n  \"lastName\": \"User\",\n  \"countryCode\": \"+44\",\n  \"mobileNumber\": \"7700900099\",\n  \"whatsAppOptIn\": true\n}" },
            "url": { "raw": "{{baseUrl}}/users/me", "host": ["{{baseUrl}}"], "path": ["users", "me"] }
          }
        },
        {
          "name": "7.3 GET My Program Access",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "if (j.length > 0) { pm.collectionVariables.set('accessId', j[0].accessId); console.log('accessId captured:', j[0].accessId); }",
            "else console.log('No program access yet — order needs to be paid via webhook');"
          ]}}],
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/users/me/program-access", "host": ["{{baseUrl}}"], "path": ["users", "me", "program-access"] }
          }
        },
        {
          "name": "7.4 Submit GDPR Deletion Request",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 202 or 409', () => pm.expect(pm.response.code).to.be.oneOf([202, 409]));"
          ]}}],
          "request": {
            "method": "POST",
            "header": [],
            "url": { "raw": "{{baseUrl}}/users/me/gdpr-deletion-request", "host": ["{{baseUrl}}"], "path": ["users", "me", "gdpr-deletion-request"] }
          }
        }
      ]
    },

    {
      "name": "Step 8 — Expert Dashboard",
      "item": [
        {
          "name": "8.1 GET My Expert Profile",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/experts/me", "host": ["{{baseUrl}}"], "path": ["experts", "me"] }
          }
        },
        {
          "name": "8.2 GET My Programs",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Programs:', pm.response.json().length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/experts/me/programs", "host": ["{{baseUrl}}"], "path": ["experts", "me", "programs"] }
          }
        },
        {
          "name": "8.3 GET My Enrollments",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "if (j.length > 0) { pm.collectionVariables.set('accessId', j[0].accessId); }",
            "console.log('Enrollments:', j.length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/experts/me/enrollments", "host": ["{{baseUrl}}"], "path": ["experts", "me", "enrollments"] }
          }
        },
        {
          "name": "8.4 Send Progress Update to Enrolled User",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has progress update payload', () => {",
            "    pm.expect(j).to.have.property('accessId');",
            "    pm.expect(j).to.have.property('isUpdated', true);",
            "    pm.expect(j).to.have.property('emailQueued');",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{expertToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"updateNote\": \"Great progress this week! Keep following the nutrition plan.\",\n  \"sendEmail\": true\n}" },
            "url": { "raw": "{{baseUrl}}/experts/me/enrollments/{{accessId}}/progress-update", "host": ["{{baseUrl}}"], "path": ["experts", "me", "enrollments", "{{accessId}}", "progress-update"] }
          }
        }
      ]
    },

    {
      "name": "Step 9 — Admin: User & Expert Management",
      "item": [
        {
          "name": "9.1 GET Admin Summary",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Summary:', JSON.stringify(pm.response.json()));"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/summary", "host": ["{{baseUrl}}"], "path": ["admin", "summary"] }
          }
        },
        {
          "name": "9.2 GET All Users",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Total users:', pm.response.json().length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/users", "host": ["{{baseUrl}}"], "path": ["admin", "users"] }
          }
        },
        {
          "name": "9.3 Deactivate User",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has deactivate payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isActive', false);",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "url": { "raw": "{{baseUrl}}/admin/users/{{userId}}/deactivate", "host": ["{{baseUrl}}"], "path": ["admin", "users", "{{userId}}", "deactivate"] }
          }
        },
        {
          "name": "9.4 Activate User",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has activate payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isActive', true);",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "url": { "raw": "{{baseUrl}}/admin/users/{{userId}}/activate", "host": ["{{baseUrl}}"], "path": ["admin", "users", "{{userId}}", "activate"] }
          }
        },
        {
          "name": "9.5 Soft-Delete User",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has delete payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isDeleted', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/admin/users/{{userId}}", "host": ["{{baseUrl}}"], "path": ["admin", "users", "{{userId}}"] }
          }
        },
        {
          "name": "9.6 GET All Experts",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "if (j.length > 0) {",
            "  const id = j[0].expertId || j[0].id;",
            "  if (id) pm.collectionVariables.set('expertId', id);",
            "}",
            "console.log('Total experts:', j.length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/experts", "host": ["{{baseUrl}}"], "path": ["admin", "experts"] }
          }
        },
        {
          "name": "9.7 Update Expert",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has update payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"title\": \"Updated Expert Title\"\n}" },
            "url": { "raw": "{{baseUrl}}/admin/experts/{{expertId}}", "host": ["{{baseUrl}}"], "path": ["admin", "experts", "{{expertId}}"] }
          }
        },
        {
          "name": "9.8 Activate Expert",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has activate payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isActive', true);",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "url": { "raw": "{{baseUrl}}/admin/experts/{{expertId}}/activate", "host": ["{{baseUrl}}"], "path": ["admin", "experts", "{{expertId}}", "activate"] }
          }
        },
        {
          "name": "9.9 Deactivate Expert",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has deactivate payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isActive', false);",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "url": { "raw": "{{baseUrl}}/admin/experts/{{expertId}}/deactivate", "host": ["{{baseUrl}}"], "path": ["admin", "experts", "{{expertId}}", "deactivate"] }
          }
        },
        {
          "name": "9.10 Change User Role (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has role-change payload', () => {",
            "  pm.expect(j).to.have.property('userId');",
            "  pm.expect(j).to.have.property('roleId');",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});",
            "console.log('User role changed. RoleId: 1=Admin, 2=Expert, 3=User');"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"userId\": \"{{userId}}\",\n  \"roleId\": 2\n}" },
            "url": { "raw": "{{baseUrl}}/admin/user/change-role", "host": ["{{baseUrl}}"], "path": ["admin", "user", "change-role"] }
          }
        }
      ]
    },

    {
      "name": "Step 10 — Admin: Coupons",
      "item": [
        {
          "name": "10.1 GET All Coupons",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Coupons:', pm.response.json().length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/coupons", "host": ["{{baseUrl}}"], "path": ["admin", "coupons"] }
          }
        },
        {
          "name": "10.2 Update Coupon",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"discountValue\": 15,\n  \"maxUses\": 200\n}" },
            "url": { "raw": "{{baseUrl}}/admin/coupons/{{couponId}}", "host": ["{{baseUrl}}"], "path": ["admin", "coupons", "{{couponId}}"] }
          }
        },
        {
          "name": "10.3 Deactivate Coupon",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "pm.test('Has deactivate payload', () => {",
            "  pm.expect(j).to.have.property('id');",
            "  pm.expect(j).to.have.property('isActive', false);",
            "  pm.expect(j).to.have.property('isUpdated', true);",
            "});"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "url": { "raw": "{{baseUrl}}/admin/coupons/{{couponId}}/deactivate", "host": ["{{baseUrl}}"], "path": ["admin", "coupons", "{{couponId}}", "deactivate"] }
          }
        }
      ]
    },

    {
      "name": "Step 11 — Admin: Orders, Refunds & Reports",
      "item": [
        {
          "name": "11.1 GET All Orders",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Total orders:', pm.response.json().length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/orders", "host": ["{{baseUrl}}"], "path": ["admin", "orders"] }
          }
        },
        {
          "name": "11.2 Initiate Refund (Admin)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 422 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 422, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has refund payload', () => {",
            "    pm.expect(j).to.have.property('orderId');",
            "    pm.expect(j).to.have.property('action', 'REFUND_INITIATED');",
            "    pm.expect(j).to.have.property('isUpdated', true);",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"refundAmount\": 50.00,\n  \"reason\": \"Customer requested refund\"\n}" },
            "url": { "raw": "{{baseUrl}}/orders/{{orderId}}/refund", "host": ["{{baseUrl}}"], "path": ["orders", "{{orderId}}", "refund"] }
          }
        },
        {
          "name": "11.3 GET Audit Log",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "console.log('Audit entries:', pm.response.json().length);"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/audit-log?limit=50", "host": ["{{baseUrl}}"], "path": ["admin", "audit-log"], "query": [{ "key": "limit", "value": "50" }] }
          }
        },
        {
          "name": "11.4 GET GDPR Requests (Pending)",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200', () => pm.response.to.have.status(200));",
            "const j = pm.response.json();",
            "if (j.length > 0) { pm.collectionVariables.set('gdprRequestId', j[0].id); console.log('gdprRequestId captured:', j[0].id); }"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/admin/gdpr-requests?status=Pending", "host": ["{{baseUrl}}"], "path": ["admin", "gdpr-requests"], "query": [{ "key": "status", "value": "Pending" }] }
          }
        },
        {
          "name": "11.5 Process GDPR Request",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has GDPR process payload', () => {",
            "    pm.expect(j).to.have.property('requestId');",
            "    pm.expect(j).to.have.property('action');",
            "    pm.expect(j).to.have.property('isUpdated', true);",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"action\": \"Complete\"\n}" },
            "url": { "raw": "{{baseUrl}}/admin/gdpr-requests/{{gdprRequestId}}/process", "host": ["{{baseUrl}}"], "path": ["admin", "gdpr-requests", "{{gdprRequestId}}", "process"] }
          }
        }
      ]
    },

    {
      "name": "Step 12 — Cleanup",
      "description": "Run cleanup calls last. These are destructive soft-delete operations for guided content created during testing.",
      "item": [
        {
          "name": "12.1 Soft-Delete Program",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has delete payload', () => {",
            "    pm.expect(j).to.have.property('id');",
            "    pm.expect(j).to.have.property('isDeleted', true);",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/guided/programs/{{programId}}", "host": ["{{baseUrl}}"], "path": ["guided", "programs", "{{programId}}"] }
          }
        },
        {
          "name": "12.2 Soft-Delete Category",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has delete payload', () => {",
            "    pm.expect(j).to.have.property('id');",
            "    pm.expect(j).to.have.property('isDeleted', true);",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/guided/categories/{{categoryId}}", "host": ["{{baseUrl}}"], "path": ["guided", "categories", "{{categoryId}}"] }
          }
        },
        {
          "name": "12.3 Soft-Delete Domain",
          "event": [{ "listen": "test", "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 or 404', () => pm.expect(pm.response.code).to.be.oneOf([200, 404]));",
            "if (pm.response.code === 200) {",
            "  const j = pm.response.json();",
            "  pm.test('Has delete payload', () => {",
            "    pm.expect(j).to.have.property('id');",
            "    pm.expect(j).to.have.property('isDeleted', true);",
            "  });",
            "}"
          ]}}],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/guided/domains/{{domainId}}", "host": ["{{baseUrl}}"], "path": ["guided", "domains", "{{domainId}}"] }
          }
        }
      ]
    },

    {
      "name": "Webhooks (Gateway-Triggered — Manual Testing Only)",
      "description": "These are called by payment gateways, not by the frontend. Signatures must be real to pass verification.",
      "item": [
        {
          "name": "CashFree Webhook (example body)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-webhook-signature", "value": "REPLACE_WITH_REAL_HMAC_SIGNATURE" },
              { "key": "x-webhook-timestamp", "value": "1234567890" }
            ],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"data\": {\n    \"order\": {\n      \"order_id\": \"{{orderId}}\",\n      \"order_amount\": 320.00,\n      \"order_currency\": \"INR\"\n    },\n    \"payment\": {\n      \"cf_payment_id\": \"cf_test_123\",\n      \"payment_status\": \"SUCCESS\",\n      \"payment_amount\": 320.00\n    }\n  },\n  \"type\": \"PAYMENT_SUCCESS_WEBHOOK\"\n}" },
            "url": { "raw": "{{baseUrl}}/payments/cashfree/webhook", "host": ["{{baseUrl}}"], "path": ["payments", "cashfree", "webhook"] }
          }
        },
        {
          "name": "PayPal Webhook (example body)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "paypal-auth-algo", "value": "SHA256withRSA" },
              { "key": "paypal-cert-url", "value": "https://api.sandbox.paypal.com/v1/notifications/certs/CERT-xxx" },
              { "key": "paypal-transmission-id", "value": "REPLACE_WITH_REAL_ID" },
              { "key": "paypal-transmission-sig", "value": "REPLACE_WITH_REAL_SIG" },
              { "key": "paypal-transmission-time", "value": "2026-01-01T00:00:00Z" }
            ],
            "body": { "mode": "raw", "options": { "raw": { "language": "json" } }, "raw": "{\n  \"id\": \"WH-xxx\",\n  \"event_type\": \"CHECKOUT.ORDER.APPROVED\",\n  \"resource\": {\n    \"id\": \"PAYPAL_ORDER_ID\",\n    \"custom_id\": \"{{orderId}}\",\n    \"status\": \"COMPLETED\"\n  }\n}" },
            "url": { "raw": "{{baseUrl}}/payments/paypal/webhook", "host": ["{{baseUrl}}"], "path": ["payments", "paypal", "webhook"] }
          }
        }
      ]
    }

  ]
}
